<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>5 in a row</title>
	<link rel="stylesheet" href="main.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<h1 class="result"> Grid Test </h1>
<div class="square"></div>
<div class="menu">
	<h1> test </h1>
	<h1> more tests </h1>
	<h1> more more tests </h1>
<div>
</div>
</body>

</html>

<script>

var mousedown = false;
var ipos;
var ibgpos;
var isqpos;

$('html').on('mousedown', startDragMouse).on('mouseup mouseleave', function() {
	mousedown = false;
});

$('html').on('mousemove', function(e) {
	if(mousedown) {dragMouse(e)}
});

$('html').on('click', function(e) {
	if(mousedown) {click(e)}
});

window.addEventListener("touchmove", dragFinger, {passive: false} );
window.addEventListener("touchstart", startDragFinger, {passive: false} );

function getIBGpos() {
	let ibgposString = ($('html').css("background-position")).split(',')[0].split(" ")
	let pos = [Number(ibgposString[0].split("p")[0]), Number(ibgposString[1].split("p")[0])]
	return pos;
}

function getSquarePos() {
	let sq = $('.square')
	let pos = [Number(sq.css('left').split("p")[0]),Number(sq.css('top').split("p")[0])]
	return pos
}

function startDragFinger(e) {
	e.preventDefault();
	ibgpos = getIBGpos();
	isqpos = getSquarePos();
	let pos = e.changedTouches;
	ipos = [pos[0].pageX, pos[0].pageY]
}

function dragFinger(e) {
	e.preventDefault()
	let pos = e.changedTouches
	let dx = pos[0].pageX - ipos[0]
	let dy = pos[0].pageY - ipos[1]
	var bgX = ibgpos[0] + dx
	var bgY = ibgpos[1] + dy
	var sqX = isqpos[0] + dx
	var sqY = isqpos[1] + dy
	moveGrid(bgX,bgY)
	moveSquares(sqX,sqY)
	updateText(Math.floor(bgX),Math.floor(bgY))
}

function startDragMouse(e) {
	mousedown = true;
	ibgpos = getIBGpos();
	isqpos = getSquarePos();
	ipos = [e.pageX, e.pageY]
}

function dragMouse(e) {
	let dx = e.pageX - ipos[0]
	let dy = e.pageY - ipos[1]
	var bgX = ibgpos[0] + dx
	var bgY = ibgpos[1] + dy
	var sqX = isqpos[0] + dx
	var sqY = isqpos[1] + dy
	moveGrid(bgX,bgY)
	moveSquares(sqX,sqY)
	updateText(Math.floor(bgX),Math.floor(bgY))
}

function click(e) {
	console.log("Clicked: " + e.pageX + ", " + e.pageY)

}

function moveGrid(x,y) {
	$('html').css("background-position", x + "px " + y + "px");
}

function moveSquares(x,y) {
	$(".square").css("left", x)
	$(".square").css("top", y)
}

function updateText(one,two) {
	$('h1.result').html("(" + one + ", " + two + ")");
}

class Square {
	constructor(x,y,color) {
		this.x = x;
		this.y = y;
		this.color = color;
	}
}
</script>
